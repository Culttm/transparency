/*! transparency - v0.9.0 - 2013-02-18
* https://github.com/leonidas/transparency
* Copyright (c) 2013 Jarno Keskikangas <jarno.keskikangas@leonidasoy.fi>; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},M={}.hasOwnProperty,_=function(e,t){function r(){this.constructor=e}for(var n in t)M.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};a=this.Transparency={},a.render=function(t,n,r,i){var s,o;n==null&&(n=[]),r==null&&(r={}),i==null&&(i={}),s=i.debug&&console?d:C,s("Transparency.render:",t,n,r,i);if(!t)return;return w(n)||(n=[n]),t=(o=v(t)).context||(o.context=new e(t)),t.render(n,r,i).el},c=function(e){return function(t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}},l=function(e){return function(t){return function(){return t.apply(this,arguments),e.apply(this,arguments)}}},h=l(function(){return this}),a.jQueryPlugin=h(function(e,t,n){var r,i,s,o;o=[];for(i=0,s=this.length;i<s;i++)r=this[i],o.push(a.render(r,e,t,n));return o}),a.matcher=function(e,t){return e.el.id===t||O.call(e.classNames,t)>=0||e.el.name===t||e.el.getAttribute("data-bind")===t},a.clone=function(e){var t;return typeof (t=jQuery||Zepto)=="function"?t(e).clone()[0]:void 0},e=function(){function n(e){this.el=e,this.template=p(this.el),this.instances=[new s(this.el)],this.instanceCache=[]}var e,t;return t=h(function(){this.parent=this.el.parentNode;if(this.parent)return this.nextSibling=this.el.nextSibling,this.parent.removeChild(this.el)}),e=h(function(){if(this.parent)return this.nextSibling?this.parent.insertBefore(this.el,this.nextSibling):this.parent.appendChild(this.el)}),n.prototype.render=c(t)(l(e)(h(function(e,t,n){var r,i,o,u,a,f,l;while(e.length<this.instances.length)this.instanceCache.push(this.instances.pop().remove());l=[];for(i=a=0,f=e.length;a<f;i=++a)u=e[i],(o=this.instances[i])||(o=this.instanceCache.pop()||new s(p(this.template)),this.instances.push(o.appendTo(this.el))),r=[],l.push(o.prepare(u,r).renderValues(u,r).renderDirectives(u,i,t).renderChildren(u,r,t,n));return l}))),n}(),s=function(){function t(e){this.queryCache={},this.childNodes=g(e),this.elements=y(e)}var e;return e={dispatch:function(){}},t.prototype.remove=h(function(){var e,t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.parentNode.removeChild(e));return i}),t.prototype.appendTo=h(function(e){var t,n,r,i,s;i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(e.appendChild(t));return s}),t.prototype.prepare=h(function(e){var t,n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.reset(),s.push(v(t.el).model=e);return s}),t.prototype.renderValues=h(function(e,t){var n,r,i,s;if(x(e)&&(n=this.elements[0]))return n.empty().el.appendChild(e);if(typeof e=="object"){s=[];for(r in e){if(!M.call(e,r))continue;i=e[r],i!=null&&(T(i)?s.push(function(){var e,t,s,o;s=this.matchingElements(r),o=[];for(e=0,t=s.length;e<t;e++)n=s[e],o.push(n.render(i));return o}.call(this)):typeof i=="object"?s.push(t.push(r)):s.push(void 0))}return s}}),t.prototype.renderDirectives=h(function(e,t,n){var r,i,s,o,u,a,f;f=[];for(u in n){if(!M.call(n,u))continue;i=n[u],typeof i=="object"&&f.push(function(){var n,f,l,c;l=this.matchingElements(u),c=[];for(n=0,f=l.length;n<f;n++)o=l[n],c.push(function(){var n;n=[];for(r in i){if(!M.call(i,r))continue;s=i[r];if(typeof s!="function")continue;a=s.call(e,{element:o.el,index:t,value:o.originalAttributes[r]}),a!=null?n.push(o.dispatch(r,a)):n.push(void 0)}return n}());return c}.call(this))}return f}),t.prototype.renderChildren=h(function(e,t,n,r){var i,s,o,u,f;f=[];for(o=0,u=t.length;o<u;o++)s=t[o],f.push(function(){var t,o,u,f;u=this.matchingElements(s),f=[];for(t=0,o=u.length;t<o;t++)i=u[t],f.push(a.render(i.el,e[s],n[s],r));return f}.call(this));return f}),t.prototype.matchingElements=function(e){var t,n,r;return n=(r=this.queryCache)[e]||(r[e]=function(){var n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],a.matcher(t,e)&&s.push(t);return s}.call(this)),N("Matching elements for '"+e+"':",n),n},t}(),n=function(){function e(e){this.el=e,this.childNodes=g(this.el),this.nodeName=this.el.nodeName.toLowerCase(),this.classNames=this.el.className.split(" "),this.originalAttributes={}}return e.prototype.empty=function(){var e;while(e=this.el.firstChild)this.el.removeChild(e);return this},e.prototype.reset=function(){var e,t,n,r;n=this.originalAttributes,r=[];for(e in n)t=n[e],r.push(this.dispatch(e,t));return r},e.prototype.render=function(e){return this.setText(e)},e.prototype.setHtml=function(e){var t,n,r,i,s,o,u;(s=(n=this.originalAttributes)["html"])==null&&(n.html=this.el.innerHTML),this.empty(),this.el.innerHTML=e,o=this.childNodes,u=[];for(r=0,i=o.length;r<i;r++)t=o[r],u.push(this.el.appendChild(t));return u},e.prototype.setText=function(e){var t,n,r;return(r=(n=this.originalAttributes)["text"])==null&&(n.text=this.getText()),t=this.el.firstChild,t?t.nodeType!==u?this.el.insertBefore(this.el.ownerDocument.createTextNode(e),t):t.nodeValue=e:this.el.appendChild(this.el.ownerDocument.createTextNode(e))},e.prototype.setClassName=function(e){var t,n;return(n=(t=this.originalAttributes)["class"])==null&&(t["class"]=this.el.className),this.el.className=e},e.prototype.getText=function(){var e;return function(){var t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.nodeType===u&&i.push(e.nodeValue);return i}.call(this).join("")},e.prototype.dispatch=function(e,t){var n,r;return n={text:this.setText,html:this.setHtml,"class":this.setClassName},r=n[e]||function(t){return this.attr(e,t)},r.call(this,t)},e.prototype.attr=function(e,t){var n,r,i,s;return this.el[e]=t,E(t)?((i=(n=this.originalAttributes)[e])==null&&(n[e]=this.el.getAttribute(e)||!1),t?this.el.setAttribute(e,e):this.el.removeAttribute(e)):((s=(r=this.originalAttributes)[e])==null&&(r[e]=this.el.getAttribute(e)||""),this.el.setAttribute(e,t.toString()))},e}(),r={elements:{},createElement:function(e){var t;return t=r.elements[e.nodeName.toLowerCase()]||n,new t(e)}},o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _(t,e),r.elements.select=t,t.prototype.render=function(e){var t,n,r,i,s;e=e.toString(),i=y(this.el),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.nodeName==="option"&&s.push(t.el.selected=t.el.value===e);return s},t}(n),f=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}var t,n,i,s;_(o,e),t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];for(i=0,s=t.length;i<s;i++)n=t[i],r.elements[n]=o;return o.prototype.setText=function(){},o}(n),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _(t,e),r.elements.input=t,t.prototype.render=function(e){return this.attr("value",e)},t}(f),g=function(e){var t,n;n=[],t=e.firstChild;while(t)n.push(t),t=t.nextSibling;return n},y=function(e){var t;return t=[],L(e,t),t},L=function(e,n){var i,s;i=e.firstChild,s=[];while(i)i.nodeType===t&&(n.push(new r.createElement(i)),L(i,n)),s.push(i=i.nextSibling);return s},t=1,u=3,b=function(){return document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>"},p=typeof document=="undefined"||document===null||b()?function(e){return e.cloneNode(!0)}:function(e){var n,r,i,s,o;n=a.clone(e);if(n.nodeType===t){n.removeAttribute(m),o=n.getElementsByTagName("*");for(i=0,s=o.length;i<s;i++)r=o[i],r.removeAttribute(m)}return n},m="transparency",v=function(e){return e[m]||(e[m]={})},C=function(){},d=function(){return console.log(arguments)},N=C,k=Object.prototype.toString,w=Array.isArray||function(e){return k.call(e)==="[object Array]"},S=function(e){return k.call(e)==="[object Date]"},x=function(e){return e.nodeType===t},T=function(e){var t;return t=typeof e,t!=="object"&&t!=="function"||S(e)},E=function(e){return e===!0||e===!1},(A=jQuery||Zepto)!=null&&(A.fn.render=a.jQueryPlugin),(typeof define!="undefined"&&define!==null?define.amd:void 0)&&define(function(){return a})}).call(this);