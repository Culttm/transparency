/*! transparency - v0.8.2 - 2013-02-16
* https://github.com/leonidas/transparency
* Copyright (c) 2013 Jarno Keskikangas <jarno.keskikangas@leonidasoy.fi>; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C={}.hasOwnProperty,k=[].slice;s=this.Transparency={},s.render=function(t,n,r,i){var s,o;n==null&&(n=[]),r==null&&(r={}),i==null&&(i={}),s=i.debug&&console?a:S,s("Transparency.render:",t,n,r,i);if(!t)return;return v(n)||(n=[n]),t=(o=f(t)).context||(o.context=new e(t)),t.detach().render(n,r,i).attach()},s.jQueryPlugin=function(e,t,n){var r,i,o;for(i=0,o=this.length;i<o;i++)r=this[i],s.render(r,e,t,n);return this},s.matcher=function(e,t){return e.id===t||d(e.className.split(" "),t)>-1||e.name===t||e.getAttribute("data-bind")===t},s.clone=function(e){var t;return typeof (t=jQuery||Zepto)=="function"?t(e).clone()[0]:void 0},e=function(){function e(e){this.el=e,this.template=u(this.el),this.instances=[new r(this.el)],this.instanceCache=[]}return e.prototype.detach=function(){return this.parent=this.el.parentNode,this.parent&&(this.nextSibling=this.el.nextSibling,this.parent.removeChild(this.el)),this},e.prototype.attach=function(){return this.parent&&(this.nextSibling?this.parent.insertBefore(this.el,this.nextSibling):this.parent.appendChild(this.el)),this},e.prototype.render=function(e,t,n){var i,s,o,a,f;while(e.length<this.instances.length)this.instanceCache.push(this.instances.pop().remove());for(i=a=0,f=e.length;a<f;i=++a)o=e[i],(s=this.instances[i])||(s=this.instanceCache.pop()||new r(u(this.template)),this.instances.push(s.appendTo(this.el))),s.reset().render(o,i,t,n);return this},e}(),r=function(){function e(e){this.queryCache={},this.childNodes=c(e),this.elements=h(e)}return e.prototype.remove=function(){var e,t,n,r;r=this.childNodes;for(t=0,n=r.length;t<n;t++)e=r[t],e.parentNode.removeChild(e);return this},e.prototype.appendTo=function(e){var t,n,r,i;i=this.childNodes;for(n=0,r=i.length;n<r;n++)t=i[n],e.appendChild(t);return this},e.prototype.reset=function(){var e,t,n,r,i,s,o;s=this.elements;for(r=0,i=s.length;r<i;r++){t=s[r],o=f(t).originalAttributes;for(e in o)n=o[e],attr(t,e,n)}return this},e.prototype.render=function(e,t,n,r){var i;return i=[],this.assoc(e).renderValues(e,i).renderDirectives(e,t,n).renderChildren(e,i,n,r)},e.prototype.assoc=function(e){var t,n,r,i;i=this.elements;for(n=0,r=i.length;n<r;n++)t=i[n],f(t.el).model=e;return this},e.prototype.renderValues=function(e,t){var n,r,i,s,o,u,a;if(y(e)&&(n=this.elements[0]))n.empty().el.appendChild(e);else if(typeof e=="object")for(r in e){if(!C.call(e,r))continue;s=e[r];if(s!=null)if(b(s)){a=this.matchingElements(r);for(o=0,u=a.length;o<u;o++)n=a[o],i=n.nodeName.toLowerCase(),i==="input"?n.attr("value",s):i==="select"?n.attr("selected",s):n.attr("text",s)}else typeof s=="object"&&t.push(r)}return this},e.prototype.renderDirectives=function(e,t,n){var r,i,s,o,u,a,f,l,c;if(!n)return this;e=typeof e=="object"?e:{value:e};for(u in n){if(!C.call(n,u))continue;i=n[u];if(typeof i=="object"){c=this.matchingElements(u);for(f=0,l=c.length;f<l;f++){o=c[f];for(r in i){s=i[r];if(typeof s!="function")continue;a=s.call(e,{element:o.el,index:t,value:o.originalAttributes[r]}),o.attr(r,a)}}}}return this},e.prototype.renderChildren=function(e,t,n,r){var i,o,u,a,f,l,c;for(u=0,f=t.length;u<f;u++){o=t[u],c=this.matchingElements(o);for(a=0,l=c.length;a<l;a++)i=c[a],s.render(i.el,e[o],n[o],r)}return this},e.prototype.matchingElements=function(e){var t,n,r;return n=(r=this.queryCache)[e]||(r[e]=function(){var n,r,i,o;i=this.elements,o=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.matcher(t.el,e)&&o.push(t);return o}.call(this)),E("Matching elements for '"+e+"':",n),n},e}(),c=function(e){var t,n;n=[],t=e.firstChild;while(t)n.push(t),t=t.nextSibling;return n},h=function(e){var t;return t=[],T(e,t),t},T=function(e,r){var i,s;i=e.firstChild,s=[];while(i)i.nodeType===t&&(r.push(new n(i)),T(i,r)),s.push(i=i.nextSibling);return s},n=function(){function e(e){this.el=e,this.childNodes=c(this.el),this.nodeName=this.el.nodeName.toLowerCase(),this.originalAttributes={}}return e.prototype.empty=function(){var e;while(e=this.el.firstChild)this.el.removeChild(e);return this},e.prototype.setHtml=function(e){var t,n,r,i,s;this.empty(),this.el.innerHTML=e,i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.el.appendChild(t));return s},e.prototype.setText=function(e){var t;return t=this.el.firstChild,t?t.nodeType!==i?this.el.insertBefore(this.el.ownerDocument.createTextNode(e),t):t.nodeValue=e:this.el.appendChild(this.el.ownerDocument.createTextNode(e))},e.prototype.getText=function(){var e;return function(){var t,n,r,s;r=this.childNodes,s=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.nodeType===i&&s.push(e.nodeValue);return s}.call(this).join("")},e.prototype.setSelected=function(e){var t,n,r,i,s;e=e.toString(),n=h(this.el),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],t.el.nodeName.toLowerCase()==="option"?t.el.value===e?s.push(t.el.selected=!0):s.push(t.el.selected=!1):s.push(void 0);return s},e.prototype.attr=function(e,t){var n,r,i,s,o,u,a,f,l,c;if(t==null)return;if(this.nodeName==="select"&&e==="selected")return this.setSelected(t);switch(e){case"text":if(!w(this.el))return(u=(n=this.originalAttributes)["text"])==null&&(n.text=this.getText()),this.setText(t);break;case"html":return(a=(r=this.originalAttributes)["html"])==null&&(r.html=this.el.innerHTML),this.setHtml(t);case"class":return(f=(i=this.originalAttributes)["class"])==null&&(i["class"]=this.el.className),this.el.className=t;default:return this.el[e]=t,m(t)?((l=(s=this.originalAttributes)[e])==null&&(s[e]=this.el.getAttribute(e)||!1),t?this.el.setAttribute(e,e):this.el.removeAttribute(e)):((c=(o=this.originalAttributes)[e])==null&&(o[e]=this.el.getAttribute(e)||""),this.el.setAttribute(e,t.toString()))}},e}(),t=1,i=3,o=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],p=function(){return document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>"},u=typeof document=="undefined"||document===null||p()?function(e){return e.cloneNode(!0)}:function(e){var n,r,i,o,u;n=s.clone(e);if(n.nodeType===t){n.removeAttribute(l),u=n.getElementsByTagName("*");for(i=0,o=u.length;i<o;i++)r=u[i],r.removeAttribute(l)}return n},l="transparency",f=function(e){return e[l]||(e[l]={})},S=function(){},a=function(){var e;return e=1<=arguments.length?k.call(arguments,0):[],console.log.apply(console,e)},E=S,x=Object.prototype.toString,g=function(e){return x.call(e)==="[object Date]"},y=function(e){return e.nodeType===t},w=function(e){return d(o,e.nodeName.toLowerCase())>-1},b=function(e){return g(e)||typeof e!="object"&&typeof e!="function"},m=function(e){return e===!0||e===!1},v=Array.isArray||function(e){return x.call(e)==="[object Array]"},d=function(e,t){var n,r,i,s;if(e.indexOf)return e.indexOf(t);for(n=i=0,s=e.length;i<s;n=++i){r=e[n];if(r===t)return n}return-1},(N=jQuery||Zepto)!=null&&(N.fn.render=s.jQueryPlugin),(typeof define!="undefined"&&define!==null?define.amd:void 0)&&define(function(){return s})}).call(this);