/*! transparency - v0.9.0 - 2013-02-18
* https://github.com/leonidas/transparency
* Copyright (c) 2013 Jarno Keskikangas <jarno.keskikangas@leonidasoy.fi>; Licensed MIT */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},j={}.hasOwnProperty,F=function(e,t){function r(){this.constructor=e}for(var n in t)j.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};d=this.Transparency={},d.render=function(e,t,n,r){var s,o;t==null&&(t=[]),n==null&&(n={}),r==null&&(r={}),s=r.debug&&console?w:_,s("Transparency.render:",e,t,n,r);if(!e)return;return C(t)||(t=[t]),e=(o=E(e)).context||(o.context=new i(e)),e.render(t,n,r).el},g=function(e){return function(t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}},m=function(e){return function(t){return function(){return t.apply(this,arguments),e.apply(this,arguments)}}},y=m(function(){return this}),d.jQueryPlugin=y(function(e,t,n){var r,i,s,o;o=[];for(i=0,s=this.length;i<s;i++)r=this[i],o.push(d.render(r,e,t,n));return o}),d.matcher=function(e,t){return e.el.id===t||B.call(e.classNames,t)>=0||e.el.name===t||e.el.getAttribute("data-bind")===t},d.clone=function(e){var t;return typeof (t=jQuery||Zepto)=="function"?t(e).clone()[0]:void 0},i=function(){function n(e){this.el=e,this.template=b(this.el),this.instances=[new l(this.el)],this.instanceCache=[]}var e,t;return t=y(function(){this.parent=this.el.parentNode;if(this.parent)return this.nextSibling=this.el.nextSibling,this.parent.removeChild(this.el)}),e=y(function(){if(this.parent)return this.nextSibling?this.parent.insertBefore(this.el,this.nextSibling):this.parent.appendChild(this.el)}),n.prototype.render=g(t)(m(e)(y(function(e,t,n){var r,i,s,o,u,a,f;while(e.length<this.instances.length)this.instanceCache.push(this.instances.pop().remove());f=[];for(i=u=0,a=e.length;u<a;i=++u)o=e[i],(s=this.instances[i])||(s=this.instanceCache.pop()||new l(b(this.template)),this.instances.push(s.appendTo(this.el))),r=[],f.push(s.prepare(o,r).renderValues(o,r).renderDirectives(o,i,t).renderChildren(o,r,t,n));return f}))),n}(),l=function(){function e(e){this.queryCache={},this.childNodes=x(e),this.elements=T(e)}return e.prototype.remove=y(function(){var e,t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.parentNode.removeChild(e));return i}),e.prototype.appendTo=y(function(e){var t,n,r,i,s;i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(e.appendChild(t));return s}),e.prototype.prepare=y(function(e){var t,n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.reset(),s.push(E(t.el).model=e);return s}),e.prototype.renderValues=y(function(e,t){var n,r,i,s;if(A(e)&&(n=this.elements[0]))return n.empty().el.appendChild(e);if(typeof e=="object"){s=[];for(r in e){if(!j.call(e,r))continue;i=e[r],i!=null&&(O(i)?s.push(function(){var e,t,s,o;s=this.matchingElements(r),o=[];for(e=0,t=s.length;e<t;e++)n=s[e],o.push(n.render(i));return o}.call(this)):typeof i=="object"?s.push(t.push(r)):s.push(void 0))}return s}}),e.prototype.renderDirectives=y(function(e,t,n){var r,i,s,o;o=[];for(s in n){if(!j.call(n,s))continue;r=n[s],typeof r=="object"&&o.push(function(){var n,o,u,a;u=this.matchingElements(s),a=[];for(n=0,o=u.length;n<o;n++)i=u[n],a.push(i.renderDirectives(e,t,r));return a}.call(this))}return o}),e.prototype.renderChildren=y(function(e,t,n,r){var i,s,o,u,a;a=[];for(o=0,u=t.length;o<u;o++)s=t[o],a.push(function(){var t,o,u,a;u=this.matchingElements(s),a=[];for(t=0,o=u.length;t<o;t++)i=u[t],a.push(d.render(i.el,e[s],n[s],r));return a}.call(this));return a}),e.prototype.matchingElements=function(e){var t,n,r;return n=(r=this.queryCache)[e]||(r[e]=function(){var n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],d.matcher(t,e)&&s.push(t);return s}.call(this)),M("Matching elements for '"+e+"':",n),n},e}(),t=function(){function t(){}return t.Attributes={},t.prototype.createAttribute=function(r,i,s){var o;return o=t.Attributes[i]||(k(s)?n:e),new o(r,i)},t}(),e=function(){function e(e,t){this.el=e,this.name=t,this.templateValue=this.el.getAttribute(this.name)||""}return e.prototype.set=function(e){return this.el[this.name]=e,this.el.setAttribute(this.name,e.toString())},e}(),n=function(e){function t(e,t){this.el=e,this.name=t,this.templateValue=this.el.getAttribute(this.name)||!1}return F(t,e),t.prototype.set=function(e){return this.el[this.name]=e,e?this.el.setAttribute(this.name,e):this.el.removeAttribute(this.name)},t}(e),p=function(){function e(e,t){var n;this.el=e,this.name=t,this.templateValue=function(){var e,t,r,i;r=x(this.el),i=[];for(e=0,t=r.length;e<t;e++)n=r[e],n.nodeType===h&&i.push(n.nodeValue);return i}.call(this).join(""),(this.textNode=this.el.firstChild)?this.textNode.nodeType!==h&&(this.textNode=this.el.insertBefore(this.el.ownerDocument.createTextNode(""),this.textNode)):this.el.appendChild(this.textNode=this.el.ownerDocument.createTextNode(""))}return t.Attributes.text=e,e.prototype.set=function(e){return this.textNode.nodeValue=e},e}(),a=function(e){function r(e){r.__super__.constructor.call(this,e,"innerHTML"),this.childNodes=x(this.el)}var n;return F(r,e),t.Attributes.html=r,n=function(){var e,t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.el.appendChild(e));return i},r.prototype.set=m(n)(function(e){return this.el.innerHTML=e}),r}(e),r=function(e){function n(e){n.__super__.constructor.call(this,e,"class")}return F(n,e),t.Attributes["class"]=n,n}(e),o=function(){function e(e){this.el=e,this.attributeFactory=new t,this.attributes={},this.childNodes=x(this.el),this.nodeName=this.el.nodeName.toLowerCase(),this.classNames=this.el.className.split(" "),this.originalAttributes={}}return e.prototype.empty=y(function(){var e,t;t=[];while(e=this.el.firstChild)t.push(this.el.removeChild(e));return t}),e.prototype.reset=function(){var e,t,n,r;n=this.attributes,r=[];for(t in n)e=n[t],r.push(e.set(e.templateValue));return r},e.prototype.render=function(e){return this.attr("text",e)},e.prototype.attr=function(e,t){var n,r;return n=(r=this.attributes)[e]||(r[e]=this.attributeFactory.createAttribute(this.el,e,t)),n.set(t)},e.prototype.renderDirectives=function(e,t,n){var r,i,s,o,u;u=[];for(i in n){if(!j.call(n,i))continue;r=n[i];if(typeof r!="function")continue;s=r.call(e,{element:this.el,index:t,value:((o=this.attributes[i])!=null?o.templateValue:void 0)||""}),s!=null?u.push(this.attr(i,s)):u.push(void 0)}return u},e}(),u={elements:{},createElement:function(e){var t;return t=u.elements[e.nodeName.toLowerCase()]||o,new t(e)}},c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return F(t,e),u.elements.select=t,t.prototype.render=function(e){var t,n,r,i,s;e=e.toString(),i=T(this.el),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.nodeName==="option"&&s.push(t.el.selected=t.el.value===e);return s},t}(o),v=function(e){function s(){return s.__super__.constructor.apply(this,arguments)}var t,n,r,i;F(s,e),t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];for(r=0,i=t.length;r<i;r++)n=t[r],u.elements[n]=s;return s.prototype.attr=function(e,t){if(e!=="text"&&e!=="html")return s.__super__.attr.call(this,e,t)},s}(o),f=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return F(t,e),u.elements.input=t,t.prototype.render=function(e){return this.attr("value",e)},t}(v),x=function(e){var t,n;n=[],t=e.firstChild;while(t)n.push(t),t=t.nextSibling;return n},T=function(e){var t;return t=[],P(e,t),t},P=function(e,t){var n,r;n=e.firstChild,r=[];while(n)n.nodeType===s&&(t.push(new u.createElement(n)),P(n,t)),r.push(n=n.nextSibling);return r},s=1,h=3,N=function(){return document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>"},b=typeof document=="undefined"||document===null||N()?function(e){return e.cloneNode(!0)}:function(e){var t,n,r,i,o;t=d.clone(e);if(t.nodeType===s){t.removeAttribute(S),o=t.getElementsByTagName("*");for(r=0,i=o.length;r<i;r++)n=o[r],n.removeAttribute(S)}return t},S="transparency",E=function(e){return e[S]||(e[S]={})},_=function(){},w=function(){return console.log(arguments)},M=_,D=Object.prototype.toString,C=Array.isArray||function(e){return D.call(e)==="[object Array]"},L=function(e){return D.call(e)==="[object Date]"},A=function(e){return e.nodeType===s},O=function(e){var t;return t=typeof e,t!=="object"&&t!=="function"||L(e)},k=function(e){return e===!0||e===!1},(H=jQuery||Zepto)!=null&&(H.fn.render=d.jQueryPlugin),(typeof define!="undefined"&&define!==null?define.amd:void 0)&&define(function(){return d})}).call(this);